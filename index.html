<!DOCTYPE html>
<html lang="es"> 
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chela Gask | Tienda</title>
<style>
:root{
--bg:#ffffff;--text:#111;--muted:#666;--brand:#111;--accent:#ff3b30;--pill:#f4f4f4;--card:#fafafa;--border:#eaeaea;
}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji";}
a{color:inherit;text-decoration:none}
img{max-width:100%;display:block}
/* Header, drawer, containers, carousel, grids, cards, footer, toast y botones */
/* ...igual que en el código anterior para no repetir aquí por longitud... */
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="header-inner">
    <button id="menuBtn" class="icon-btn" aria-label="Menú">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>
    <a href="#/" class="logo" title="Inicio">
      <img src="logochelagask.jpg" alt="Logo Chela Gask" onerror="this.src='https://dummyimage.com/120x40/000/fff&text=CHELA+GASK'"/>
      <span class="brand">Chela Gask</span>
    </a>
    <nav class="nav" id="topNav">
      <a href="#/categoria/caballero">Caballero</a>
      <a href="#/categoria/dama">Dama</a>
      <a href="#/categoria/nino">Niñ@</a>
      <a href="#/categoria/accesorios">Accesorios</a>
      <a href="#/categoria/ropones">Ropones</a>
      <a href="#/categoria/bisuteria">Bisutería</a>
    </nav>
    <div class="spacer"></div>
    <a class="icon-btn cart-wrap" href="#/carrito" aria-label="Carrito" title="Carrito">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 12.39A2 2 0 0 0 9.62 15h8.76a2 2 0 0 0 2-1.61L23 6H6"/></svg>
      <span id="cartCount" class="badge" style="display:none">0</span>
    </a>
  </div>
</header>

<!-- DRAWER -->
<div id="drawer" class="drawer">
  <div class="backdrop" onclick="toggleDrawer(false)"></div>
  <aside class="panel" role="dialog" aria-label="Menú lateral">
    <header>
      <strong>Menú</strong>
      <button class="icon-btn" onclick="toggleDrawer(false)" aria-label="Cerrar">✕</button>
    </header>
    <nav>
      <a href="#/" onclick="toggleDrawer(false)">Inicio</a>
      <a href="#/categoria/caballero" onclick="toggleDrawer(false)">Caballero</a>
      <a href="#/categoria/dama" onclick="toggleDrawer(false)">Dama</a>
      <a href="#/categoria/nino" onclick="toggleDrawer(false)">Niñ@</a>
      <a href="#/categoria/accesorios" onclick="toggleDrawer(false)">Accesorios</a>
      <a href="#/categoria/ropones" onclick="toggleDrawer(false)">Ropones</a>
      <a href="#/categoria/bisuteria" onclick="toggleDrawer(false)">Bisutería</a>
      <a href="#/carrito" onclick="toggleDrawer(false)">Carrito</a>
    </nav>
  </aside>
</div>

<!-- MAIN RENDER -->
<main id="app" class="container"></main>
<div id="toast" class="toast"></div>
<footer class="footer">
  © <span id="year"></span> Chela Gask. Todos los derechos reservados.
</footer>

<script>
const $ = s => document.querySelector(s);
const app = $('#app');
const toast = $('#toast');
let PRODUCTS = [];
let state={carousel:0};
const CATS = ['caballero','dama','nino','accesorios','ropones','bisuteria'];

function showToast(msg){ toast.textContent=msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),5000);}
function money(n){ return new Intl.NumberFormat('es-MX',{style:'currency',currency:'MXN'}).format(n); }

function getCart(){ try{ return JSON.parse(localStorage.getItem('cg_cart')||'[]'); }catch(e){return []} }
function setCart(items){ localStorage.setItem('cg_cart', JSON.stringify(items)); updateCartCount(); }
function updateCartCount(){ const c=getCart().reduce((a,i)=>a+i.cantidad,0); const el=$('#cartCount'); el.textContent=c; el.style.display=c?'inline-block':'none'; }

const drawer = $('#drawer');
$('#menuBtn').addEventListener('click', ()=>toggleDrawer(true));
function toggleDrawer(open){ drawer.classList.toggle('open',!!open) }

window.addEventListener('hashchange', router);
window.addEventListener('load', async ()=>{
  updateCartCount();
  await fetchProducts();
  router();
  $('#year').textContent=new Date().getFullYear();
  startCarousel();
});

async function fetchProducts(){
  try{
    const SHEET_JSON_URL = 'TU_URL_DE_GOOGLE_APPS_SCRIPT'; // <--- Pega tu URL aquí
    const res = await fetch(SHEET_JSON_URL);
    PRODUCTS = await res.json();
    PRODUCTS = PRODUCTS.map(p=>{
      if(typeof p.imagenes==='string') p.imagenes=p.imagenes.split('|');
      if(typeof p.tallas==='string') p.tallas=p.tallas.split('|');
      if(typeof p.stock==='string') p.stock=JSON.parse(p.stock);
      p.precio=parseFloat(p.precio);
      p.promo=p.promo==='true'||p.promo===true;
      return p;
    });
  }catch(e){ console.error('Error cargando productos:',e); }
}

// ---------------- ROUTER -----------------
function router(){
  const hash=location.hash||'#/';
  if(hash==='#/'){ renderHome(); return; }
  if(hash.startsWith('#/categoria/')){ renderCategory(hash.split('/')[2]); return; }
  if(hash.startsWith('#/producto/')){ renderProduct(hash.split('/')[2]); return; }
  if(hash==='#/carrito'){ renderCart(); return; }
  if(hash==='#/gracias'){ renderPostPago(); return; }
  app.innerHTML='<p>Página no encontrada</p>';
}

// ---------------- HOME -----------------
function renderHome(){
  app.innerHTML=`
  <h2>Bienvenido a Chela Gask</h2>
  <div class="grid cols-4" id="catGrid"></div>
  <div class="banner">
    <h3>Atención y envíos</h3>
    <p>Envíos a todo México. Tiempo estimado 2–5 días hábiles.</p>
    <p>Cambios y devoluciones dentro de los 7 días con ticket.</p>
    <p>WhatsApp de atención: 44xx xxx xxx (10:00–19:00).</p>
    <p>Promos y novedades en Instagram: @chelagask.</p>
  </div>
  `;
  const grid=$('#catGrid');
  CATS.forEach(cat=>{
    grid.innerHTML+=`<a href="#/categoria/${cat}" class="card"><div class="meta"><strong>${cat.toUpperCase()}</strong></div></a>`;
  });
}

// ---------------- CATEGORY -----------------
function renderCategory(cat){
  const prods = PRODUCTS.filter(p=>p.categoria.toLowerCase()===cat.toLowerCase());
  if(prods.length===0){ app.innerHTML='<p>No hay productos en esta categoría.</p>'; return;}
  app.innerHTML=`<h2>${cat.toUpperCase()}</h2><div class="grid cols-4" id="prodGrid"></div>`;
  const grid=$('#prodGrid');
  prods.forEach(p=>{
    grid.innerHTML+=`
    <a href="#/producto/${p.id}" class="card">
      <img src="${p.imagenes[0]}" alt="${p.nombre}">
      <div class="meta">
        <p>${p.nombre}</p>
        <p class="price">${money(p.precio)}</p>
      </div>
    </a>
    `;
  });
}

// ---------------- PRODUCT -----------------
function renderProduct(id){
  const p = PRODUCTS.find(x=>x.id==id);
  if(!p){ app.innerHTML='<p>Producto no encontrado</p>'; return; }
  app.innerHTML=`
  <h2>${p.nombre}</h2>
  <img src="${p.imagenes[0]}" style="max-width:300px">
  <p class="price">${money(p.precio)}</p>
  <div class="form">
    <label>Talla:</label>
    <select id="selTalla">${p.tallas.map(t=>`<option value="${t}">${t}</option>`).join('')}</select>
    <label>Cantidad:</label>
    <input type="number" id="selCant" min="1" max="10" value="1">
    <button class="btn" id="addCartBtn">Agregar al carrito</button>
  </div>
  `;
  $('#addCartBtn').addEventListener('click', ()=>{
    const talla=$('#selTalla').value;
    const cantidad=parseInt($('#selCant').value)||1;
    const cart=getCart();
    const exists=cart.find(c=>c.id==p.id && c.talla===talla);
    if(exists){ exists.cantidad+=cantidad; } else { cart.push({id:p.id,nombre:p.nombre,precio:p.precio,talla,cantidad}); }
    setCart(cart); showToast('Producto agregado al carrito');
  });
}

// ---------------- CART -----------------
function renderCart(){
  const cart=getCart();
  if(cart.length===0){ app.innerHTML='<p>Carrito vacío</p>'; return; }
  app.innerHTML='<h2>Carrito</h2><div id="cartItems"></div><h3>Total: <span id="cartTotal"></span></h3><button class="btn" id="btnComprar">Comprar</button>';
  const container=$('#cartItems');
  cart.forEach((c,i)=>{
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`<p>${c.nombre} - Talla: ${c.talla}</p><div class="qty"><button>-</button><span>${c.cantidad}</span><button>+</button></div><p>${money(c.precio*c.cantidad)}</p>`;
    const btns=div.querySelectorAll('button');
    btns[0].onclick=()=>{ if(c.cantidad>1)c.cantidad--; setCart(cart); renderCart(); }
    btns[1].onclick=()=>{ c.cantidad++; setCart(cart); renderCart(); }
    container.appendChild(div);
  });
  const total=cart.reduce((a,c)=>a+c.precio*c.cantidad,0);
  $('#cartTotal').textContent=money(total);
  $('#btnComprar').onclick=()=>{ localStorage.removeItem('cg_cart'); location.hash='#/gracias'; }
}

// ---------------- POST-PAGO -----------------
function renderPostPago(){
  app.innerHTML='<h2>¡Gracias por tu compra!</h2><p>Tu pedido ha sido procesado correctamente.</p>';
}

// ---------------- CAROUSEL -----------------
function startCarousel(){
  if(CAROUSEL_IMAGES.length===0) return;
  const container=document.createElement('div');
  container.className='carousel';
  const img=document.createElement('img');
  img.src=CAROUSEL_IMAGES[0];
  container.appendChild(img);
  const dots=document.createElement('div'); dots.className='dots';
  CAROUSEL_IMAGES.forEach((_,i)=>{ const s=document.createElement('span'); if(i===0)s.classList.add('active'); dots.appendChild(s); });
  container.appendChild(dots);
  app.prepend(container);
  setInterval(()=>{
    state.carousel=(state.carousel+1)%CAROUSEL_IMAGES.length;
    img.src=CAROUSEL_IMAGES[state.carousel];
    dots.querySelectorAll('span').forEach((s,i)=>s.classList.toggle('active',i===state.carousel));
  },4000);
}
</script>
</body>
</html>
